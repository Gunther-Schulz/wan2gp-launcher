#!/bin/bash
#########################################################
# Wan2GP Configuration File - SAMPLE
# Copy this file to wan2gp-config.sh and customize as needed
# Only contains settings you might actually want to customize
# All other settings use sensible built-in defaults
#########################################################

#########################################################
# Basic Configuration
#########################################################

# Cache and cleanup behavior
AUTO_CACHE_CLEANUP=false           # Set to true to enable automatic cache cleanup
CACHE_SIZE_THRESHOLD=100          # Cache size in MB before cleanup (only if AUTO_CACHE_CLEANUP=true)

# Git update behavior  
AUTO_GIT_UPDATE=false             # Set to true to enable automatic git updates

# Package version verification
AUTO_CHECK_PACKAGES=true          # Check if installed packages match requirements.txt on every run
AUTO_FIX_PACKAGE_MISMATCHES=true  # Automatically fix version mismatches (false = only warn)

# System paths (leave empty "" to use defaults)
TEMP_CACHE_DIR=""                 # Custom temp cache directory (empty "" = system default)
CONDA_EXE="/opt/miniconda3/bin/conda"                   # Fallback conda path (script checks PATH first)
                                  # Most users don't need to change this - script auto-detects conda

# Save path configuration (leave empty "" to let Wan2GP choose)
# These are only used as fallback if save_path.json doesn't exist
SCRIPT_SAVE_PATH=""               # Video save path (empty "" = app decides)
SCRIPT_IMAGE_SAVE_PATH=""         # Image save path (empty "" = app decides)

#########################################################
# Network & Performance
#########################################################

# Server configuration
DEFAULT_SERVER_PORT="7862"        # Default server port for Gradio interface

# Performance settings
DEFAULT_ENABLE_TCMALLOC=true      # Enable TCMalloc for better memory performance (true/false)

# Attention optimization packages
# Flash Attention: Fallback attention optimization (slower than SageAttention but more compatible)
# SageAttention: Primary attention optimization (2-5x faster, recommended)
INSTALL_FLASH_ATTENTION=false     # Set to true to install Flash Attention as fallback (default: false, SageAttention is preferred)

# SageAttention version configuration
# Version 2 (2.2.0 - SageAttention2++):
#   - Works on most modern GPUs (Ampere 8.x, Ada Lovelace 8.9, Hopper 9.0)
#   - RTX 3060/3090, RTX 4060/4090, A100, H100
#   - Provides 2-5x speedup with per-thread quantization
#   - Stable and well-tested
# Version 3 (SageAttention3 - Blackwell optimized):
#   - Optimized for RTX 50xx series (RTX 5070, 5080, 5090)
#   - Requires compute capability ≥10.0 (Blackwell architecture)
#   - Includes microscaling FP4 attention for up to 5x speedup
#   - Early access features, may require compilation from source
#   - Will be ignored on older GPUs (automatically falls back)
DEFAULT_SAGE_VERSION="auto"      # Options: "auto", "2", "3", or "none"
                                  # "auto" (default) = Auto-detect based on GPU:
                                  #   • RTX 5070/5080/5090 → SageAttention3 (FP4, up to 5x faster)
                                  #   • Other GPUs → SageAttention 2.2.0
                                  # "2" = Always use SageAttention 2.2.0
                                  #   • Compatible with RTX 20xx/30xx/40xx, A100, H100
                                  #   • Requirements: Python >=3.9, PyTorch >=2.0, CUDA >=12.0
                                  # "3" = Always use SageAttention3
                                  #   • Optimized for RTX 50xx Blackwell architecture
                                  #   • Requirements: Python >=3.13, PyTorch >=2.8.0, CUDA >=12.8
                                  # "none" = Disable SageAttention (use PyTorch attention instead)
                                  # Command-line override: --sage2, --sage3

SAGE_ATTENTION_VERSION="2.2.0"   # Desired SageAttention version (1.0.6, 2.2.0, etc.)
AUTO_UPGRADE_SAGE=false           # Automatically upgrade SageAttention if version mismatch (false = prompt user)

#########################################################
# Repository Configuration (for custom fork)
#########################################################

# Only needed if you want to customize the fork repository
# CUSTOM_REPO_URL="https://github.com/Gunther-Schulz/Wan2GP.git"  
# CUSTOM_REPO_BRANCH="combined-features"    # Specific branch for enhanced features

#########################################################
# Directory Organization (Auto-Detected)
#########################################################

# The launcher automatically detects and configures these directories:
#
# models/wan2gp/
#   - Automatically added to checkpoints_paths in wgp_config.json
#   - Place model .safetensors files here
#   - Models will be available alongside files in ckpts/
#
# finetunes/wan2gp/
#   - JSON files automatically symlinked into Wan2GP/finetunes/
#   - Place custom model definition .json files here
#   - Keeps your finetunes organized outside the Wan2GP repository
#
# No configuration needed - just create these directories and the launcher
# will handle the rest on every startup.

#########################################################
# Privacy & Logging
#########################################################

# Disable error reporting to external services
DISABLE_ERROR_REPORTING=true

#########################################################
# Advanced Configuration (rarely needed)
#########################################################

# AMD GPU overrides (only needed for specific AMD GPUs)
# AMD_NAVI1_GFX_VERSION="10.3.0"
# AMD_NAVI2_GFX_VERSION="10.3.0"
# AMD_RENOIR_GFX_VERSION="9.0.0"

# SageAttention compilation tuning (only if compilation fails)
# SAGE_MAX_JOBS=8              # Max parallel jobs for compilation
# SAGE_NVCC_THREADS=8          # NVCC compiler threads
# SAGE_PARALLEL_JOBS=4         # Parallel compilation jobs

# Conda environment customization
# CONDA_ENV_NAME="wan2gp"
# CONDA_ENV_FILE="environment-wan2gp.yml"

# TCMalloc compatibility threshold
# TCMALLOC_GLIBC_THRESHOLD="2.34"

# Alternative official repository URL
# OFFICIAL_REPO_URL="https://github.com/deepbeepmeep/Wan2GP.git"
# OFFICIAL_REPO_BRANCH=""  # Leave empty for default branch

#########################################################
# Example Configurations
#########################################################

# Example 1: Basic setup with custom temp directory
# TEMP_CACHE_DIR="/tmp/wan2gp-cache"
# SCRIPT_SAVE_PATH="/home/user/Videos/wan2gp"
# SCRIPT_IMAGE_SAVE_PATH="/home/user/Pictures/wan2gp"

# Example 2: Performance-focused setup
# AUTO_CACHE_CLEANUP=true
# CACHE_SIZE_THRESHOLD=50
# DEFAULT_SAGE_VERSION="3"  # For Blackwell GPUs only

# Example 3: Development setup with auto-updates
# AUTO_GIT_UPDATE=true
# DEFAULT_SERVER_PORT="8080"
